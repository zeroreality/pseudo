﻿<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Date prototype tests</title>
	<!-- jasmine -->
	<link rel="stylesheet" href="../jasmine-3.5.0/jasmine.css">
	<script src="../jasmine-3.5.0/jasmine.js"></script>
	<script src="../jasmine-3.5.0/jasmine-html.js"></script>
	<script src="../jasmine-3.5.0/boot.js"></script>
</head>
<body>
	<script>var ns = {};</script>
	<script src="../../src/_include.js"></script>
	<script src="../../src/objects/Array.js"></script>
	<script src="../../src/objects/Date.js"></script>
	<!-- support -->
	<script type="text/javascript">
		var epoch = new Date(0),
			midnight = Date.midnight();
	</script>
	<!-- test -->
	<script type="text/javascript" defer="defer">
		describe("Date#addYear", function() {
			var base;
			beforeEach(function() {
				base = new Date(2020, 0, 1);
			});
			it("without", function() {
				base.addYear();
				expect(base.getFullYear()).toBe(2021);
			});
			it("with NaN", function() {
				base.addYear(NaN);
				expect(base.getFullYear()).toBe(2021);
			});
			it("with null", function() {
				base.addYear(NaN);
				expect(base.getFullYear()).toBe(2021);
			});
			it("with string", function() {
				base.addYear("string");
				expect(base.getFullYear()).toBe(2021);
			});
			it("with numeric-string", function() {
				base.addYear("5");
				expect(base.getFullYear()).toBe(2021);
			});
			it("with 1", function() {
				base.addYear(1);
				expect(base.getFullYear()).toBe(2021);
			});
			it("with 5", function() {
				base.addYear(5);
				expect(base.getFullYear()).toBe(2025);
			});
			it("with -5", function() {
				base.addYear(-5);
				expect(base.getFullYear()).toBe(2015);
			});
		});
		describe("Date#addMonth", function() {
			var base,
				jan31;
			beforeEach(function() {
				base = new Date(2020, 0, 1);
				jan31 = new Date(2020, 0, 31);
			});
			it("without", function() {
				base.addMonth();
				expect(base.getMonth()).toBe(1);
			});
			it("with NaN", function() {
				base.addMonth(NaN);
				expect(base.getMonth()).toBe(1);
			});
			it("with null", function() {
				base.addMonth(NaN);
				expect(base.getMonth()).toBe(1);
			});
			it("with string", function() {
				base.addMonth("string");
				expect(base.getMonth()).toBe(1);
			});
			it("with numeric-string", function() {
				base.addMonth("5");
				expect(base.getMonth()).toBe(1);
			});
			it("with 1", function() {
				base.addMonth(1);
				expect(base.getMonth()).toBe(1);
			});
			it("with 5", function() {
				base.addMonth(5);
				expect(base.getMonth()).toBe(5);
			});
			it("with -5", function() {
				base.addMonth(-5);
				expect(base.getMonth()).toBe(12 - 5);
			});
		});
		describe("Date#addDate", function() {
			var base;
			beforeEach(function() {
				base = new Date(2020, 0, 1);
			});
			it("without", function() {
				base.addDate();
				expect(base.getDate()).toBe(2);
			});
			it("with NaN", function() {
				base.addDate(NaN);
				expect(base.getDate()).toBe(2);
			});
			it("with null", function() {
				base.addDate(NaN);
				expect(base.getDate()).toBe(2);
			});
			it("with string", function() {
				base.addDate("string");
				expect(base.getDate()).toBe(2);
			});
			it("with numeric-string", function() {
				base.addDate("5");
				expect(base.getDate()).toBe(2);
			});
			it("with 1", function() {
				base.addDate(1);
				expect(base.getDate()).toBe(2);
			});
			it("with 5", function() {
				base.addDate(5);
				expect(base.getDate()).toBe(6);
			});
			it("with -5", function() {
				base.addDate(-5);
				expect(base.getDate()).toBe(1 + 31 - 5); // Jan 1, Dec 31 days => 32 - 5
			});
		});
		describe("Date#addHours", function() {
			var base;
			beforeEach(function() {
				base = new Date(2020, 0, 1);
			});
			it("without", function() {
				base.addHours();
				expect(base.getHours()).toBe(1);
			});
			it("with NaN", function() {
				base.addHours(NaN);
				expect(base.getHours()).toBe(1);
			});
			it("with null", function() {
				base.addHours(NaN);
				expect(base.getHours()).toBe(1);
			});
			it("with string", function() {
				base.addHours("string");
				expect(base.getHours()).toBe(1);
			});
			it("with numeric-string", function() {
				base.addHours("5");
				expect(base.getHours()).toBe(1);
			});
			it("with 1", function() {
				base.addHours(1);
				expect(base.getHours()).toBe(1);
			});
			it("with 5", function() {
				base.addHours(5);
				expect(base.getHours()).toBe(5);
			});
			it("with -5", function() {
				base.addHours(-5);
				expect(base.getHours()).toBe(24 - 5);
			});
		});
		describe("Date#addMinutes", function() {
			var base;
			beforeEach(function() {
				base = new Date(2020, 0, 1);
			});
			it("without", function() {
				base.addMinutes();
				expect(base.getMinutes()).toBe(1);
			});
			it("with NaN", function() {
				base.addMinutes(NaN);
				expect(base.getMinutes()).toBe(1);
			});
			it("with null", function() {
				base.addMinutes(NaN);
				expect(base.getMinutes()).toBe(1);
			});
			it("with string", function() {
				base.addMinutes("string");
				expect(base.getMinutes()).toBe(1);
			});
			it("with numeric-string", function() {
				base.addMinutes("5");
				expect(base.getMinutes()).toBe(1);
			});
			it("with 1", function() {
				base.addMinutes(1);
				expect(base.getMinutes()).toBe(1);
			});
			it("with 5", function() {
				base.addMinutes(5);
				expect(base.getMinutes()).toBe(5);
			});
			it("with -5", function() {
				base.addMinutes(-5);
				expect(base.getMinutes()).toBe(60 - 5);
			});
		});
		describe("Date#addSeconds", function() {
			var base;
			beforeEach(function() {
				base = new Date(2020, 0, 1);
			});
			it("without", function() {
				base.addSeconds();
				expect(base.getSeconds()).toBe(1);
			});
			it("with NaN", function() {
				base.addSeconds(NaN);
				expect(base.getSeconds()).toBe(1);
			});
			it("with null", function() {
				base.addSeconds(NaN);
				expect(base.getSeconds()).toBe(1);
			});
			it("with string", function() {
				base.addSeconds("string");
				expect(base.getSeconds()).toBe(1);
			});
			it("with numeric-string", function() {
				base.addSeconds("5");
				expect(base.getSeconds()).toBe(1);
			});
			it("with 1", function() {
				base.addSeconds(1);
				expect(base.getSeconds()).toBe(1);
			});
			it("with 5", function() {
				base.addSeconds(5);
				expect(base.getSeconds()).toBe(5);
			});
			it("with -5", function() {
				base.addSeconds(-5);
				expect(base.getSeconds()).toBe(60 - 5);
			});
		});
		describe("Date#addMilliseconds", function() {
			var base;
			beforeEach(function() {
				base = new Date(2020, 0, 1);
			});
			it("without", function() {
				base.addMilliseconds();
				expect(base.getMilliseconds()).toBe(1);
			});
			it("with NaN", function() {
				base.addMilliseconds(NaN);
				expect(base.getMilliseconds()).toBe(1);
			});
			it("with null", function() {
				base.addMilliseconds(NaN);
				expect(base.getMilliseconds()).toBe(1);
			});
			it("with string", function() {
				base.addMilliseconds("string");
				expect(base.getMilliseconds()).toBe(1);
			});
			it("with numeric-string", function() {
				base.addMilliseconds("5");
				expect(base.getMilliseconds()).toBe(1);
			});
			it("with 1", function() {
				base.addMilliseconds(1);
				expect(base.getMilliseconds()).toBe(1);
			});
			it("with 5", function() {
				base.addMilliseconds(5);
				expect(base.getMilliseconds()).toBe(5);
			});
			it("with -5", function() {
				base.addMilliseconds(-5);
				expect(base.getMilliseconds()).toBe(1000 - 5);
			});
		});
		describe("Date#context", function() {
			var base,
				//milli,
				second,
				minute,
				hour,
				day,
				week,
				month,
				year;
			beforeEach(function() {
				base = new Date(2020, 0, 1);
				//milli = new Date(base).addMilliseconds(1);
				second = new Date(base).addSeconds(1);
				minute = new Date(base).addMinutes(1);
				hour = new Date(base).addHours(1);
				day = new Date(base).addDate(1);
				week = new Date(base).addDate(7);
				month = new Date(base).addMonth(1);
				year = new Date(base).addYear(1);
			});

			it("same date", function() {
				expect(base.context(base)).toEqual([]);
				expect(midnight.context(midnight)).toEqual([]);
				expect(epoch.context(epoch)).toEqual([]);
			});
			/*
			it("milli: future to past", function() {
				var compare = milli.context(base, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(-1);
				expect(compare[0].type).toBe("fff");
			});
			it("milli: past to future", function() {
				var compare = base.context(milli, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(1);
				expect(compare[0].type).toBe("fff");
			});
			*/
			it("second: future to past", function() {
				var compare = second.context(base, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(-1);
				expect(compare[0].type).toBe("ss");
			});
			it("second: past to future", function() {
				var compare = base.context(second, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(1);
				expect(compare[0].type).toBe("ss");
			});
			it("minute: future to past", function() {
				var compare = minute.context(base, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(-1);
				expect(compare[0].type).toBe("mm");
			});
			it("minute: past to future", function() {
				var compare = base.context(minute, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(1);
				expect(compare[0].type).toBe("mm");
			});
			it("hour: future to past", function() {
				var compare = hour.context(base, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(-1);
				expect(compare[0].type).toBe("hh");
			});
			it("hour: past to future", function() {
				var compare = base.context(hour, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(1);
				expect(compare[0].type).toBe("hh");
			});
			it("day: future to past", function() {
				var compare = day.context(base, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(-1);
				expect(compare[0].type).toBe("dd");
			});
			it("day: past to future", function() {
				var compare = base.context(day, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(1);
				expect(compare[0].type).toBe("dd");
			});
			it("week: future to past", function() {
				var compare = week.context(base, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(-1);
				expect(compare[0].type).toBe("ww");
			});
			it("week: past to future", function() {
				var compare = base.context(week, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(1);
				expect(compare[0].type).toBe("ww");
			});
			it("month: future to past", function() {
				var compare = month.context(base, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(-1);
				expect(compare[0].type).toBe("MM");
			});
			it("month: past to future", function() {
				var compare = base.context(month, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(1);
				expect(compare[0].type).toBe("MM");
			});
			it("year: future to past", function() {
				var compare = year.context(base, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(-1);
				expect(compare[0].type).toBe("yyyy");
			});
			it("year: past to future", function() {
				var compare = base.context(year, 9);
				expect(compare.length).toBe(1);
				expect(compare[0].value).toBe(1);
				expect(compare[0].type).toBe("yyyy");
			});
		});
		describe("Date#zero", function() {
			var base;
			beforeEach(function() {
				base = new Date(1979, 8, 11, 12, 34, 56, 789);
			});
			it("no args", function() {
				base.zero();
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(789);
			});
			it("fff", function() {
				base.zero("fff");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(0);
			});
			it("ss", function() {
				base.zero("ss");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(0);
				expect(base.getMilliseconds()).toBe(789);
			});
			it("mm", function() {
				base.zero("mm");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(0);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(789);
			});
			it("hh", function() {
				base.zero("hh");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(0);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(789);
			});
			it("dd", function() {
				base.zero("dd");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(1);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(789);
			});
			it("ww", function() {
				base.zero("ww");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11 - 2);	// Sept 11 was a Tuesday
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(789);
			});
			it("MM", function() {
				base.zero("MM");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(0);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(789);
			});
			it("yyyy", function() {
				base.zero("yyyy");
				expect(base.getFullYear()).toBe(1970);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(789);
			});

			it("yyyy dd", function() {
				base.zero("yyyy", "dd");
				expect(base.getFullYear()).toBe(1970);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(1);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(789);
			});
			it("mm fff", function() {
				base.zero("mm", "fff");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(0);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(0);
			});

			it("fff+", function() {
				base.zero("fff+");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(56);
				expect(base.getMilliseconds()).toBe(0);
			});
			it("ss+", function() {
				base.zero("ss+");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(34);
				expect(base.getSeconds()).toBe(0);
				expect(base.getMilliseconds()).toBe(0);
			});
			it("mm+", function() {
				base.zero("mm+");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(12);
				expect(base.getMinutes()).toBe(0);
				expect(base.getSeconds()).toBe(0);
				expect(base.getMilliseconds()).toBe(0);
			});
			it("hh+", function() {
				base.zero("hh+");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(0);
				expect(base.getMinutes()).toBe(0);
				expect(base.getSeconds()).toBe(0);
				expect(base.getMilliseconds()).toBe(0);
			});
			it("dd+", function() {
				base.zero("dd+");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(8);
				expect(base.getDate()).toBe(1);
				expect(base.getHours()).toBe(0);
				expect(base.getMinutes()).toBe(0);
				expect(base.getSeconds()).toBe(0);
				expect(base.getMilliseconds()).toBe(0);
			});
			it("MM+", function() {
				base.zero("MM+");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(0);
				expect(base.getDate()).toBe(1);
				expect(base.getHours()).toBe(0);
				expect(base.getMinutes()).toBe(0);
				expect(base.getSeconds()).toBe(0);
				expect(base.getMilliseconds()).toBe(0);
			});
			it("yyyy+", function() {
				base.zero("yyyy+");
				expect(base.getFullYear()).toBe(1970);
				expect(base.getMonth()).toBe(0);
				expect(base.getDate()).toBe(1);
				expect(base.getHours()).toBe(0);
				expect(base.getMinutes()).toBe(0);
				expect(base.getSeconds()).toBe(0);
				expect(base.getMilliseconds()).toBe(0);
			});

			it("MM hh+", function() {
				base.zero("MM", "hh+");
				expect(base.getFullYear()).toBe(1979);
				expect(base.getMonth()).toBe(0);
				expect(base.getDate()).toBe(11);
				expect(base.getHours()).toBe(0);
				expect(base.getMinutes()).toBe(0);
				expect(base.getSeconds()).toBe(0);
				expect(base.getMilliseconds()).toBe(0);
			});
		});
	</script>
</body>
</html>